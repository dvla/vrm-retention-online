# compile.yml
#
- name: install unzip
  yum: name=unzip

- name: install rubygems
  yum: name=rubygems

- name: install ruby-devel
  yum: name=ruby-devel

- name: task_description
  command: gem install sass
    creates=/usr/bin/sass
  tags:
    - sass

- name: task_description
  command: gem install fpm
    creates=/usr/bin/fpm
  tags:
    - fpm

- name: install rpm-build
  yum: name=rpm-build

- name: install java-1.7.0-openjdk
  yum: name=java-1.7.0-openjdk

- name: install java-1.7.0-openjdk-devel
  yum: name=java-1.7.0-openjdk-devel

- name: install fpm
  gem: name=fpm state=present

- name: get sbt
  get_url: dest=/tmp/sbt.rpm url=http://scalasbt.artifactoryonline.com/scalasbt/sbt-native-packages/org/scala-sbt/sbt/0.13.1/sbt.rpm

- name: install sbt
  command: yum localinstall /tmp/sbt.rpm -y
    creates=/usr/bin/sbt

- name: move vehiclesOnline.conf
  command: mv /vagrant/conf/vrm-retention-online.conf /tmp/vrm-retention-online.conf

- name: move google-analytics.conf
  command: mv /vagrant/conf/google-analytics.conf /tmp/google-analytics.conf
  
- name: sbt dist
  command: sbt dist
    chdir=/vagrant
  tags:
    - sbt-dist
  register: sbt-dist-result
  ignore_errors: True

- name: put vehiclesOnline.conf back
  command: mv /tmp/vrm-retention-online.conf /vagrant/conf/vrm-retention-online.conf

- name: put google-analytics.conf back
  command: mv /tmp/google-analytics.conf /vagrant/conf/google-analytics.conf

- name: run jenkins_job_make_rpm
  shell: cd /vagrant/rpm-build && export WORKSPACE=/vagrant && bash jenkins_job_make_rpm
  tags:
    - jenkins_job_make_rpm
