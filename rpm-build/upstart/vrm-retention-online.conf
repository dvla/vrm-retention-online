# upstart/vrm-retention-online.conf
#
description "vrm-retention-online"

start on runlevel [345]
stop on starting shutdown

respawn

script
    cd /opt/vrm-retention-online
    echo $$ > /var/run/vrm-retention-online.pid

    export JAVA_OPTS="-Xms512M -Xmx1024M -XX:PermSize=128M \
        -XX:MaxPermSize=256M -XX:+UseConcMarkSweepGC \
        -XX:+UseParNewGC -XX:+CMSClassUnloadingEnabled \
        -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps \
        -XX:-HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/opt/vrm-retention-online/logs/ \
        $JAVA_OPTS"

    exec su -s /bin/bash -c \
        'exec /opt/vrm-retention-online/bin/vrm-retention-online \
        -Dhttp.port=9004 \
        -Dconfig.file=/opt/vrm-retention-online/conf/application.conf \
        -Dlogger.file=/opt/vrm-retention-online/conf/prod-logger.xml\
        > /opt/vrm-retention-online/logs/out.log 2>&1' \
        vrm-retention-online
end script

pre-start script
    rm -f /opt/vrm-retention-online/RUNNING_PID
end script
